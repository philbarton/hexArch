Shared adapter code used by the different adapter implementations